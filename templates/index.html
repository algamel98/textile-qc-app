<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Textile QC System - Professional Color & Pattern Analysis</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="icon" type="image/png" href="/static/images/logo_square_no_name_1024x1024.png">
</head>
<body>
    <!-- Sample Tests Side Menu Toggle Button -->
    <button class="samples-toggle-btn" id="samplesToggleBtn" type="button" title="Sample Tests">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
        </svg>
        <span>Samples</span>
    </button>

    <!-- Sample Tests Side Menu -->
    <div class="samples-sidebar" id="samplesSidebar">
        <div class="samples-sidebar-header">
            <div class="samples-sidebar-title">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                </svg>
                <span>Sample Tests</span>
            </div>
            <button class="samples-sidebar-close" id="samplesSidebarClose" type="button">&times;</button>
        </div>
        <div class="samples-sidebar-body" id="samplesSidebarBody">
            <!-- Sample cards will be injected by JavaScript -->
            <div class="samples-loading">
                <div class="spinner-small"></div>
                <span>Loading samples...</span>
            </div>
        </div>
        <div class="samples-sidebar-footer">
            <p>Pre-configured tests with generated reports</p>
        </div>
    </div>

    <!-- Sidebar Overlay -->
    <div class="samples-overlay" id="samplesOverlay"></div>

    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <img src="/static/images/logo_square_with_name_1024x1024.png" alt="Textile QC Logo" class="logo">
            <div class="header-title">
                <h1>Textile QC System</h1>
                <span class="subtitle">Professional Color & Pattern Analysis</span>
            </div>
        </div>
        <div class="header-right">
            <!-- Source Code Download Button -->
            <div class="code-download-container">
                <button class="btn-code-download" id="btnCodeDownload" type="button">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="16 18 22 12 16 6"></polyline>
                        <polyline points="8 6 2 12 8 18"></polyline>
                    </svg>
                    <span>Source Code</span>
                    <svg class="chevron" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </button>
                <div class="code-dropdown" id="codeDropdown">
                    <div class="dropdown-header">Download Source</div>
                    <div class="dropdown-item" data-type="py">
                        <div class="dropdown-item-left">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                            </svg>
                            <div class="dropdown-item-info">
                                <span class="dropdown-item-title">Python (.py)</span>
                                <span class="dropdown-item-desc">Standard Python script</span>
                            </div>
                        </div>
                        <button class="btn-help" data-help="py" type="button" title="Learn more">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="dropdown-item" data-type="ipynb">
                        <div class="dropdown-item-left">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                                <line x1="8" y1="21" x2="16" y2="21"></line>
                                <line x1="12" y1="17" x2="12" y2="21"></line>
                            </svg>
                            <div class="dropdown-item-info">
                                <span class="dropdown-item-title">Jupyter Notebook (.ipynb)</span>
                                <span class="dropdown-item-desc">For Google Colab</span>
                            </div>
                        </div>
                        <button class="btn-help" data-help="ipynb" type="button" title="Learn more">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <span class="version-badge">v1.0.0</span>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header Text -->
        <div class="page-header">
            <h2>Image Quality Control Analysis</h2>
            <p>Upload reference and sample images to begin quality control analysis</p>
        </div>

        <!-- Split Image Viewer -->
        <div class="image-viewer-container">
            <div class="image-viewer">
                <!-- Reference Image Panel -->
                <div class="viewer-panel">
                    <div class="panel-header">
                        <span class="panel-title"><span class="dot ref"></span>Reference Image</span>
                        <span class="panel-info" id="refInfo">No image</span>
                    </div>
                    <div class="panel-content" id="refPanelContent">
                        <input type="file" id="refInput" accept="image/*" style="display:none;">
                        <div class="upload-placeholder" id="refPlaceholder" onclick="document.getElementById('refInput').click()">
                            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                            <span>Reference Image</span>
                            <small>Click to upload</small>
                        </div>
                        <img id="refPreview" class="image-preview" style="display:none;">
                        <div class="shape-overlay circle" id="refOverlay"></div>
                    </div>
                </div>

                <!-- Sample Image Panel -->
                <div class="viewer-panel">
                    <div class="panel-header">
                        <span class="panel-title"><span class="dot sample"></span>Sample Image</span>
                        <span class="panel-info" id="testInfo">No image</span>
                    </div>
                    <div class="panel-content" id="testPanelContent">
                        <input type="file" id="testInput" accept="image/*" style="display:none;">
                        <div class="upload-placeholder" id="testPlaceholder" onclick="document.getElementById('testInput').click()">
                            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                            <span>Sample Image</span>
                            <small>Click to upload</small>
                        </div>
                        <img id="testPreview" class="image-preview" style="display:none;">
                        <div class="shape-overlay circle" id="testOverlay"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controls Section -->
        <div class="controls-section">
            <!-- Shape Controls -->
            <div class="shape-controls">
                <div class="shape-options">
                    <label class="shape-option active" id="circleOption">
                        <input type="radio" name="shapeType" value="circle" checked>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle></svg>
                        <span>Circle</span>
                    </label>
                    
                    <label class="shape-option" id="squareOption">
                        <input type="radio" name="shapeType" value="square">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"></rect></svg>
                        <span>Square</span>
                    </label>
                    
                    <label class="shape-option" id="fullImageOption">
                        <input type="checkbox" id="processFullImage">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="2"></rect><path d="M2 12h20M12 2v20"></path></svg>
                        <span>Process Entire Image</span>
                    </label>
                </div>

                <div class="size-slider-container" id="sizeSliderContainer">
                    <label>Size (px):</label>
                    <input type="range" id="shapeSize" min="20" max="500" value="100">
                    <span class="size-value" id="sizeValue">100 px</span>
                </div>
            </div>

            <!-- Main Buttons -->
            <div class="main-buttons">
                <button class="btn btn-outline" id="btnAdvancedSettings" type="button">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"></path>
                    </svg>
                    Advanced Settings
                </button>
                
                <button class="btn btn-primary" id="btnStartProcessing" type="button" disabled>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    Start Processing
                </button>
                
                <button class="btn btn-danger" id="btnDeleteImages" type="button" disabled>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                    Delete Images
                </button>
            </div>
        </div>

        <!-- Results Section (Hidden by default) -->
        <div class="results-section" id="resultsSection" style="display:none;">
            <div class="results-header">
                <h2>Analysis Results</h2>
                <div class="decision-badge" id="decisionBadge">PENDING</div>
            </div>
            
            <div class="results-grid">
                <div class="result-card">
                    <div class="card-header">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <circle cx="12" cy="12" r="6"></circle>
                            <circle cx="12" cy="12" r="2"></circle>
                        </svg>
                        <span>Color Score</span>
                    </div>
                    <div class="card-value" id="colorScore">--</div>
                    <div class="card-bar"><div class="bar-fill" id="colorBar"></div></div>
                </div>
                
                <div class="result-card">
                    <div class="card-header">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                        <span>Pattern Score</span>
                    </div>
                    <div class="card-value" id="patternScore">--</div>
                    <div class="card-bar"><div class="bar-fill" id="patternBar"></div></div>
                </div>
                
                <div class="result-card">
                    <div class="card-header">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                        </svg>
                        <span>Overall Score</span>
                    </div>
                    <div class="card-value" id="overallScore">--</div>
                    <div class="card-bar"><div class="bar-fill" id="overallBar"></div></div>
                </div>
            </div>
            
            <div class="results-actions">
                <button class="btn btn-success" id="btnDownload" type="button" disabled>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Download Report (PDF)
                </button>
                <button class="btn btn-secondary btn-sm" id="btnDownloadSettings" type="button">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    Download Settings
                </button>
            </div>
        </div>
    </main>

    <!-- Loading Overlay (Hidden by default) -->
    <div class="loading-overlay" id="loadingOverlay" style="display:none;">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3 id="loadingTitle">Processing...</h3>
            <p id="loadingText">Please wait</p>
        </div>
    </div>

    <!-- Settings Modal (Hidden by default) -->
    <div class="modal-overlay" id="settingsModal" style="display:none;">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-header-left">
                    <img src="/static/images/logo_square_no_name_1024x1024.png" alt="Logo" class="modal-logo">
                    <div>
                        <h2>Advanced Settings</h2>
                        <span class="modal-subtitle">Configure analysis parameters</span>
                    </div>
                </div>
                <button class="modal-close" id="closeModal" type="button">&times;</button>
            </div>
            
            <div class="modal-tabs">
                <button class="tab active" data-tab="thresholds" type="button">Thresholds</button>
                <button class="tab" data-tab="color" type="button">Color Analysis</button>
                <button class="tab" data-tab="pattern" type="button">Pattern Analysis</button>
                <button class="tab" data-tab="report" type="button">Report Sections</button>
            </div>
            
            <div class="modal-body">
                <!-- Thresholds Tab -->
                <div class="tab-content active" id="tab-thresholds">
                    <div class="settings-group">
                        <h3>Color Thresholds</h3>
                        <div class="setting-row">
                            <label>ΔE Pass Threshold</label>
                            <input type="number" id="delta_e_threshold" value="2.0" step="0.1" min="0">
                        </div>
                        <div class="setting-row">
                            <label>ΔE Conditional Threshold</label>
                            <input type="number" id="delta_e_conditional" value="3.5" step="0.1" min="0">
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h3>Pattern Thresholds</h3>
                        <div class="setting-row">
                            <label>SSIM Pass Threshold</label>
                            <input type="number" id="ssim_pass_threshold" value="0.95" step="0.01" min="0" max="1">
                        </div>
                        <div class="setting-row">
                            <label>SSIM Conditional Threshold</label>
                            <input type="number" id="ssim_conditional_threshold" value="0.90" step="0.01" min="0" max="1">
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h3>Score Thresholds</h3>
                        <div class="setting-row">
                            <label>Color Score Threshold</label>
                            <input type="number" id="color_score_threshold" value="70" step="1" min="0" max="100">
                        </div>
                        <div class="setting-row">
                            <label>Pattern Score Threshold</label>
                            <input type="number" id="pattern_score_threshold" value="90" step="1" min="0" max="100">
                        </div>
                        <div class="setting-row">
                            <label>Overall Score Threshold</label>
                            <input type="number" id="overall_score_threshold" value="70" step="1" min="0" max="100">
                        </div>
                    </div>
                </div>
                
                <!-- Color Analysis Tab -->
                <div class="tab-content" id="tab-color">
                    <div class="settings-group">
                        <h3>Color Difference Methods</h3>
                        <div class="setting-row">
                            <label>Use CMC Color Difference</label>
                            <input type="checkbox" id="use_delta_e_cmc" checked>
                        </div>
                        <div class="setting-row">
                            <label>CMC l:c Ratio</label>
                            <select id="cmc_l_c_ratio">
                                <option value="2:1" selected>2:1 (Acceptability)</option>
                                <option value="1:1">1:1 (Perceptibility)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h3>Spectrophotometer Settings</h3>
                        <div class="setting-row">
                            <label>Observer Angle</label>
                            <select id="observer_angle">
                                <option value="2" selected>2° Standard Observer</option>
                                <option value="10">10° Standard Observer</option>
                            </select>
                        </div>
                        <div class="setting-row">
                            <label>Geometry Mode</label>
                            <select id="geometry_mode">
                                <option value="d/8 SCI" selected>d/8 SCI</option>
                                <option value="d/8 SCE">d/8 SCE</option>
                                <option value="45/0">45/0</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Pattern Analysis Tab -->
                <div class="tab-content" id="tab-pattern">
                    <div class="settings-group">
                        <h3>Texture Parameters</h3>
                        <div class="setting-row">
                            <label>LBP Points</label>
                            <input type="number" id="lbp_points" value="24" step="1" min="8">
                        </div>
                        <div class="setting-row">
                            <label>LBP Radius</label>
                            <input type="number" id="lbp_radius" value="3" step="1" min="1">
                        </div>
                        <div class="setting-row">
                            <label>Wavelet Type</label>
                            <select id="wavelet_type">
                                <option value="db4" selected>Daubechies 4</option>
                                <option value="haar">Haar</option>
                                <option value="sym4">Symlet 4</option>
                            </select>
                        </div>
                        <div class="setting-row">
                            <label>Wavelet Levels</label>
                            <input type="number" id="wavelet_levels" value="3" step="1" min="1" max="5">
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h3>Pattern Repetition</h3>
                        <div class="setting-row">
                            <label>Pattern Min Area (px)</label>
                            <input type="number" id="pattern_min_area" value="100" step="10" min="10">
                        </div>
                        <div class="setting-row">
                            <label>Pattern Max Area (px)</label>
                            <input type="number" id="pattern_max_area" value="5000" step="100" min="100">
                        </div>
                        <div class="setting-row">
                            <label>Keypoint Detector</label>
                            <select id="keypoint_detector">
                                <option value="ORB" selected>ORB (Fast)</option>
                                <option value="SIFT">SIFT (Accurate)</option>
                                <option value="AKAZE">AKAZE</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Report Sections Tab -->
                <div class="tab-content" id="tab-report">
                    <div class="settings-group">
                        <h3>Report Sections</h3>
                        <div class="setting-row">
                            <label>Color Unit</label>
                            <input type="checkbox" id="enable_color_unit" checked>
                        </div>
                        <div class="setting-row">
                            <label>Pattern Unit</label>
                            <input type="checkbox" id="enable_pattern_unit" checked>
                        </div>
                        <div class="setting-row">
                            <label>Pattern Repetition</label>
                            <input type="checkbox" id="enable_pattern_repetition" checked>
                        </div>
                        <div class="setting-row">
                            <label>Spectrophotometer</label>
                            <input type="checkbox" id="enable_spectrophotometer" checked>
                        </div>
                        <div class="setting-row">
                            <label>Analysis Settings Page</label>
                            <input type="checkbox" id="enable_analysis_settings">
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h3>Operator Info</h3>
                        <div class="setting-row">
                            <label>Operator Name</label>
                            <input type="text" id="operator_name" value="Operator">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" id="btnResetSettings" type="button">Reset to Defaults</button>
                <div class="modal-footer-right">
                    <button class="btn btn-secondary" id="btnCancelSettings" type="button">Cancel</button>
                    <button class="btn btn-primary" id="btnApplySettings" type="button">Apply Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Source Code Help Dialog -->
    <div class="help-dialog-overlay" id="helpDialogOverlay" style="display:none;">
        <div class="help-dialog">
            <div class="help-dialog-header">
                <div class="help-dialog-icon" id="helpDialogIcon"></div>
                <h3 id="helpDialogTitle">Format Information</h3>
                <button class="help-dialog-close" id="helpDialogClose" type="button">&times;</button>
            </div>
            <div class="help-dialog-body" id="helpDialogBody">
                <!-- Content injected by JavaScript -->
            </div>
            <div class="help-dialog-footer">
                <button class="btn btn-primary btn-sm" id="helpDialogDownload" type="button">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Download this format
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <img src="/static/images/logo_square_no_name_1024x1024.png" alt="Logo">
        <span>© 2025 Textile Engineering Solutions | Abdelbary Algamel PAU</span>
    </footer>

    <script src="/static/js/app.js"></script>
</body>
</html>
